{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/checkout.css' %}">
{% endblock %}

{% block content %}
    <div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">

        <p class="lead mb-4">
            <strong>Payment complete!</strong>
            Thank you for your order, {{ order.full_name }}.
            Your confirmation of this order will be sent to {{ order.email }}.
        </p>

        <div class="card shadow-sm mb-4">
            <div class="card-header bg-light">
            <div class="d-flex justify-content-between flex-wrap gap-2 align-items-center">
                <div>
                <h5 class="mb-0">Order Summary</h5>
                <small class="text-muted">
                    Order #
                    <code id="orderNo">{{ order.order_number }}</code>
                    <button class="btn btn-sm btn-outline-secondary ms-1"
                            type="button"
                            onclick="navigator.clipboard.writeText(document.getElementById('orderNo').textContent)">
                    Copy
                    </button>
                </small>
                </div>
                <div class="d-flex align-items-center gap-2">
                <small class="text-muted">{{ order.date|date:"j M Y, H:i" }}</small>
                </div>
            </div>
            </div>

            <div class="card-body">
            <div class="table-responsive mb-3">
                <table class="table align-middle mb-0">
                <thead class="table-light">
                    <tr>
                    <th>Pattern</th>
                    <th class="text-end">Price</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in order.lineitems.all %}
                    <tr>
                        <td>{{ item.pattern.name|default:item.pattern.title }}</td>
                        <td class="text-end">£{{ item.lineitem_total|floatformat:2 }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="2" class="text-center text-muted py-4">No items found for this order.</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                    <th class="text-end">Total</th>
                    <th class="text-end">£{{ order.order_total|floatformat:2 }}</th>
                    </tr>
                </tfoot>
                </table>
            </div>

            <div class="row g-4 mt-1">
                <div class="col-md-6">
                <h6 class="text-uppercase text-muted mb-2">Contact</h6>
                <ul class="list-unstyled mb-0">
                    <li><strong>Name:</strong> {{ order.full_name }}</li>
                    <li><strong>Email:</strong> {{ order.email }}</li>
                    <li><strong>Phone:</strong> {{ order.phone_number }}</li>
                </ul>
                </div>
                <div class="col-md-6">
                <h6 class="text-uppercase text-muted mb-2">Address</h6>
                <address class="mb-0">
                    {{ order.street_address1 }}{% if order.street_address2 %}, {{ order.street_address2 }}{% endif %}<br>
                    {{ order.town_or_city }}{% if order.county %}, {{ order.county }}{% endif %}<br>
                    {{ order.postcode }}{% if order.country %}, {{ order.country }}{% endif %}
                </address>
                </div>
            </div>

            {% if order.stripe_pid %}
                <div class="mt-3 small text-muted">
                Payment ref: <code>{{ order.stripe_pid }}</code>
                </div>
            {% endif %}
            </div>
        </div>
        <div class="d-flex justify-content-end gap-2">
            <a href="{% url 'orders_list' %}" class="btn bk-button rounded-pill d-inline-flex align-items-center px-3 py-2">
            <span class="fw-semibold">My Orders</span>
            </a>
            <a href="{% url 'pattern_list' %}" class="btn bk-button rounded-pill d-inline-flex align-items-center px-3 py-2">
            <span class="fw-semibold">Back to Patterns</span>
            </a>
        </div>

        </div>
    </div>
    </div>
{% endblock %}
